<!DOCTYPE html>
<html class="wide wow-animation" lang="en">
  <head>
    <title>LexiAid - Study Insights</title>
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=PT+Serif:400,700,400italic,700italic%7CLato:300,300italic,400,400italic,700,900%7CMerriweather:700italic">
    <link rel="stylesheet" href="css/fonts.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.css">
		<!--[if lt IE 10]>
    <div style="background: #212121; padding: 10px 0; box-shadow: 3px 3px 5px 0 rgba(0,0,0,.3); clear: both; text-align:center; position: relative; z-index:1;"><a href="http://windows.microsoft.com/en-US/internet-explorer/"><img src="images/ie8-panel/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today."></a></div>
    <script src="js/html5shiv.min.js"></script>
		<![endif]-->
  </head>
  <body>
    <div class="preloader">
      <div class="preloader-body">
        <div class="cssload-container">
          <div class="cssload-speeding-wheel"> </div>
        </div>
        <p>Loading...</p>
      </div>
    </div>
    <div class="page">
      <header class="page-head">
        <div class="rd-navbar-wrap">
          <nav class="rd-navbar rd-navbar-default" data-layout="rd-navbar-fixed" data-sm-layout="rd-navbar-fixed" data-md-layout="rd-navbar-fixed" data-md-device-layout="rd-navbar-fixed" data-lg-layout="rd-navbar-fixed" data-lg-device-layout="rd-navbar-fixed" data-xl-layout="rd-navbar-static" data-xl-device-layout="rd-navbar-static" data-xxl-layout="rd-navbar-static" data-xxl-device-layout="rd-navbar-static" data-lg-stick-up-offset="53px" data-xl-stick-up-offset="53px" data-xxl-stick-up-offset="53px" data-lg-stick-up="true" data-xl-stick-up="true" data-xxl-stick-up="true">
            <div class="rd-navbar-inner">
              <div class="rd-navbar-aside-wrap">
                <div class="rd-navbar-aside">
                  <div class="rd-navbar-aside-toggle" data-rd-navbar-toggle=".rd-navbar-aside"><span></span></div>
                  <div class="rd-navbar-aside-content">
                    <ul class="rd-navbar-aside-group list-units">
                      <li>
                        <div class="unit unit-horizontal unit-spacing-xs align-items-center">
                          <div class="unit-left"><span class="novi-icon icon icon-xxs icon-primary fa-calendar"></span></div>
                          <div class="unit-body"><span class="link-dusty-gray" id="current-date">April 14, 2023</span></div>
                        </div>
                      </li>
                      <li>
                        <div class="unit unit-horizontal unit-spacing-xs align-items-center">
                          <div class="unit-left"><span class="novi-icon icon icon-xxs icon-primary fa-envelope-o"></span></div>
                          <div class="unit-body"><a class="link-dusty-gray" href="mailto:#">support@lexiaid.com</a></div>
                        </div>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="rd-navbar-group">
                <div class="rd-navbar-panel">
                  <button class="rd-navbar-toggle" data-rd-navbar-toggle=".rd-navbar-nav-wrap"><span></span></button>
                  <a class="rd-navbar-brand brand" href="index.html">
                    <h3 class="text-primary">Lexi<span style="color: #4d4d4d;">Aid</span></h3>
                  </a>
                </div>
                <div class="rd-navbar-nav-wrap">
                  <div class="rd-navbar-nav-inner">
                    <ul class="rd-navbar-nav">
                      <li><a href="index.html"><i class="fa fa-home"></i> Dashboard</a>
                      </li>
                      <li><a href="search.html"><i class="fa fa-search"></i> Search</a>
                      </li>
                      <li><a href="tasks.html"><i class="fa fa-tasks"></i> Tasks</a>
                      </li>
                      <li class="active"><a href="insights.html"><i class="fa fa-chart-bar"></i> Insights</a>
                      </li>
                      <li><a href="upload-case.html"><i class="fa fa-upload"></i> Upload Case</a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </nav>
        </div>
      </header>

      <section class="section-50 section-md-75 section-lg-100">
        <div class="container">
          <!-- Page Header -->
          <div class="row align-items-center mb-4">
            <div class="col-md-8">
              <h2>Study Insights</h2>
              <p class="text-bigger">Personalized analytics to help optimize your law school study habits.</p>
            </div>
            <div class="col-md-4 text-md-right">
              <div class="btn-group">
                <button type="button" class="btn btn-outline-primary active" data-period="weekly">Weekly</button>
                <button type="button" class="btn btn-outline-primary" data-period="monthly">Monthly</button>
                <button type="button" class="btn btn-outline-primary" data-period="semester">Semester</button>
              </div>
            </div>
          </div>

          <!-- Summary Cards -->
          <div class="row mb-4">
            <div class="col-sm-6 col-md-3 mb-3">
              <div class="card text-center h-100">
                <div class="card-body">
                  <div class="mb-3">
                    <i class="fa fa-clock text-primary" style="font-size: 2rem;"></i>
                  </div>
                  <h5 class="card-title">Total Study Time</h5>
                  <h2 class="text-primary mb-0" id="total-study-time">0</h2>
                  <p class="text-muted" id="total-study-time-label">Hours This Week</p>
                </div>
              </div>
            </div>
            <div class="col-sm-6 col-md-3 mb-3">
              <div class="card text-center h-100">
                <div class="card-body">
                  <div class="mb-3">
                    <i class="fa fa-book text-primary" style="font-size: 2rem;"></i>
                  </div>
                  <h5 class="card-title">Cases Reviewed</h5>
                  <h2 class="text-primary mb-0" id="cases-reviewed">0</h2>
                  <p class="text-muted" id="cases-reviewed-label">This Week</p>
                </div>
              </div>
            </div>
            <div class="col-sm-6 col-md-3 mb-3">
              <div class="card text-center h-100">
                <div class="card-body">
                  <div class="mb-3">
                    <i class="fa fa-check-circle text-primary" style="font-size: 2rem;"></i>
                  </div>
                  <h5 class="card-title">Tasks Completed</h5>
                  <h2 class="text-primary mb-0" id="tasks-completed">0</h2>
                  <p class="text-muted" id="tasks-completed-label">Of 0 Assigned</p>
                </div>
              </div>
            </div>
            <div class="col-sm-6 col-md-3 mb-3">
              <div class="card text-center h-100">
                <div class="card-body">
                  <div class="mb-3">
                    <i class="fa fa-graduation-cap text-primary" style="font-size: 2rem;"></i>
                  </div>
                  <h5 class="card-title">Quiz Average</h5>
                  <h2 class="text-primary mb-0" id="quiz-average">0%</h2>
                  <p class="text-muted" id="quiz-average-label">Across All Subjects</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Study Time Distribution -->
          <div class="row mb-4">
            <div class="col-lg-8">
              <div class="card h-100">
                <div class="card-header bg-primary text-white">
                  <h5 class="mb-0"><i class="fa fa-clock"></i> Study Time Distribution</h5>
                </div>
                <div class="card-body">
                  <canvas id="studyTimeChart" height="300"></canvas>
                </div>
              </div>
            </div>
            <div class="col-lg-4">
              <div class="card h-100">
                <div class="card-header bg-primary text-white">
                  <h5 class="mb-0"><i class="fa fa-pie-chart"></i> Time by Subject</h5>
                </div>
                <div class="card-body">
                  <canvas id="subjectPieChart" height="300"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Performance Analysis -->
          <div class="row mb-4">
            <div class="col-lg-6">
              <div class="card h-100">
                <div class="card-header bg-primary text-white">
                  <h5 class="mb-0"><i class="fa fa-chart-line"></i> Quiz Performance Trends</h5>
                </div>
                <div class="card-body">
                  <canvas id="quizPerformanceChart" height="300"></canvas>
                </div>
              </div>
            </div>
            <div class="col-lg-6">
              <div class="card h-100">
                <div class="card-header bg-primary text-white">
                  <h5 class="mb-0"><i class="fa fa-bullseye"></i> Performance by Topic</h5>
                </div>
                <div class="card-body">
                  <canvas id="topicPerformanceChart" height="300"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Revision Recommendations & Weak Areas -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card">
                <div class="card-header bg-primary text-white">
                  <h5 class="mb-0"><i class="fa fa-lightbulb"></i> Improvement Recommendations</h5>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                      <h5 class="border-bottom pb-2">Weak Areas Identified</h5>
                      <ul class="list-group list-group-flush" id="weak-areas-list">
                        <!-- Dynamic weak areas -->
                      </ul>
                    </div>
                    <div class="col-md-6">
                      <h5 class="border-bottom pb-2">Recommendations</h5>
                      <div id="recommendations-list">
                        <!-- Dynamic recommendations -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Study Habits Analysis -->
          <div class="row">
            <div class="col-lg-6 mb-4">
              <div class="card h-100">
                <div class="card-header bg-primary text-white">
                  <h5 class="mb-0"><i class="fa fa-user-clock"></i> Productivity by Time of Day</h5>
                </div>
                <div class="card-body">
                  <canvas id="productivityChart" height="250"></canvas>
                  <div class="mt-3">
                    <p class="text-center"><strong>Your Most Productive Time:</strong> <span class="text-primary">8:00 AM - 11:00 AM</span></p>
                    <p class="text-muted text-center small">Based on quiz performance and study efficiency metrics.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-6 mb-4">
              <div class="card h-100">
                <div class="card-header bg-primary text-white">
                  <h5 class="mb-0"><i class="fa fa-calendar-check"></i> Study Consistency</h5>
                </div>
                <div class="card-body">
                  <div class="row align-items-center">
                    <div class="col-md-5">
                      <canvas id="consistencyChart" height="200"></canvas>
                    </div>
                    <div class="col-md-7">
                      <h6 class="text-center mb-3">Weekly Study Consistency</h6>
                      <div class="progress mb-3" style="height: 25px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 85%;" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100">85%</div>
                      </div>
                      <div class="alert alert-info">
                        <i class="fa fa-info-circle"></i> You've maintained consistent study habits for 17 out of 20 days. Students with consistent study patterns typically score 23% higher on exams.
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Resource Utilization -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card">
                <div class="card-header bg-primary text-white">
                  <h5 class="mb-0"><i class="fa fa-book-reader"></i> Resource Utilization</h5>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-lg-8">
                      <canvas id="resourceUtilizationChart" height="250"></canvas>
                    </div>
                    <div class="col-lg-4">
                      <h6 class="border-bottom pb-2">Most Used Resources</h6>
                      <div class="list-group list-group-flush" id="resource-list">
                        <!-- Dynamic resources -->
                      </div>
                      <div class="alert alert-warning mt-3 mb-0">
                        <strong>Suggestion:</strong> Try to diversify your study resources for Contracts Law.
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Export Options -->
          <div class="row mb-4">
            <div class="col-12 text-center">
              <div class="btn-group">
                <button type="button" class="btn btn-outline-primary"><i class="fa fa-download"></i> Export PDF Report</button>
                <button type="button" class="btn btn-outline-primary"><i class="fa fa-envelope"></i> Email Report</button>
                <button type="button" class="btn btn-outline-primary"><i class="fa fa-print"></i> Print</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <footer class="page-footer page-footer-default bg-gray-dark">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col text-center">
              <p class="rights">LexiAid &copy; <span id="copyright-year">2023</span>. All Rights Reserved.</p>
            </div>
          </div>
        </div>
      </footer>
    </div>
    <div class="snackbars" id="form-output-global"></div>
    <script src="js/core.min.js"></script>
    <script src="js/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <script>
      // Set current date
      document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      // Set copyright year
      document.getElementById('copyright-year').textContent = new Date().getFullYear();

      // --- Chart.js chart instances (will be updated dynamically) ---
      let studyTimeChart, subjectPieChart, quizPerformanceChart, topicPerformanceChart, productivityChart, consistencyChart, resourceUtilizationChart;

      // --- Chart config templates ---
      function getChartConfigs(data) {
        return {
          studyTime: {
            type: 'bar',
            data: {
              labels: data.studyTime.labels,
              datasets: [{
                label: 'Hours Studied',
                data: data.studyTime.values,
                backgroundColor: 'rgba(54, 162, 235, 0.7)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
              }]
            },
            options: { responsive: true, scales: { y: { beginAtZero: true, title: { display: true, text: 'Hours' } } } }
          },
          subjectPie: {
            type: 'doughnut',
            data: {
              labels: data.subjectPie.labels,
              datasets: [{
                data: data.subjectPie.values,
                backgroundColor: [
                  'rgba(54, 162, 235, 0.7)',
                  'rgba(255, 99, 132, 0.7)',
                  'rgba(255, 206, 86, 0.7)',
                  'rgba(75, 192, 192, 0.7)',
                  'rgba(153, 102, 255, 0.7)'
                ],
                borderWidth: 1
              }]
            },
            options: { responsive: true, plugins: { legend: { position: 'right' } } }
          },
          quizPerformance: {
            type: 'line',
            data: {
              labels: data.quizPerformance.labels,
              datasets: data.quizPerformance.datasets
            },
            options: { responsive: true, scales: { y: { min: 0, max: 100, title: { display: true, text: 'Score (%)' } } } }
          },
          topicPerformance: {
            type: 'radar',
            data: {
              labels: data.topicPerformance.labels,
              datasets: data.topicPerformance.datasets
            },
            options: { responsive: true, scales: { r: { angleLines: { display: true }, suggestedMin: 0, suggestedMax: 100 } } }
          },
          productivity: {
            type: 'line',
            data: {
              labels: data.productivity.labels,
              datasets: [{
                label: 'Productivity Score',
                data: data.productivity.values,
                borderColor: 'rgba(54, 162, 235, 1)',
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                pointRadius: 5,
                pointHoverRadius: 7,
                tension: 0.4,
                fill: true
              }]
            },
            options: { responsive: true, scales: { y: { min: 0, max: 100, title: { display: true, text: 'Productivity Score' } } } }
          },
          consistency: {
            type: 'doughnut',
            data: {
              labels: ['Consistent', 'Inconsistent'],
              datasets: [{
                data: data.consistency.values,
                backgroundColor: [
                  'rgba(40, 167, 69, 0.7)',
                  'rgba(220, 53, 69, 0.7)'
                ],
                borderWidth: 1
              }]
            },
            options: { responsive: true, plugins: { legend: { display: false } }, cutout: '70%' }
          },
          resourceUtilization: {
            type: 'bar',
            data: {
              labels: data.resourceUtilization.labels,
              datasets: [{
                label: 'Hours Spent',
                data: data.resourceUtilization.values,
                backgroundColor: [
                  'rgba(54, 162, 235, 0.7)',
                  'rgba(255, 99, 132, 0.7)',
                  'rgba(255, 206, 86, 0.7)',
                  'rgba(75, 192, 192, 0.7)',
                  'rgba(153, 102, 255, 0.7)',
                  'rgba(255, 159, 64, 0.7)'
                ],
                borderColor: [
                  'rgba(54, 162, 235, 1)',
                  'rgba(255, 99, 132, 1)',
                  'rgba(255, 206, 86, 1)',
                  'rgba(75, 192, 192, 1)',
                  'rgba(153, 102, 255, 1)',
                  'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
              }]
            },
            options: { responsive: true, scales: { y: { beginAtZero: true, title: { display: true, text: 'Hours' } } } }
          }
        };
      }

      // --- Fetch analytics data and update charts ---
      async function loadInsights(period = 'weekly') {
        try {
          // Fetch analytics data from backend
          const response = await fetch(`insights.php?period=${period}`);
          const data = await response.json();

          // Get chart configs
          const configs = getChartConfigs(data);

          // Destroy old charts if they exist
          [studyTimeChart, subjectPieChart, quizPerformanceChart, topicPerformanceChart, productivityChart, consistencyChart, resourceUtilizationChart].forEach(chart => {
            if (chart) chart.destroy();
          });

          // Create new charts
          studyTimeChart = new Chart(document.getElementById('studyTimeChart').getContext('2d'), configs.studyTime);
          subjectPieChart = new Chart(document.getElementById('subjectPieChart').getContext('2d'), configs.subjectPie);
          quizPerformanceChart = new Chart(document.getElementById('quizPerformanceChart').getContext('2d'), configs.quizPerformance);
          topicPerformanceChart = new Chart(document.getElementById('topicPerformanceChart').getContext('2d'), configs.topicPerformance);
          productivityChart = new Chart(document.getElementById('productivityChart').getContext('2d'), configs.productivity);
          consistencyChart = new Chart(document.getElementById('consistencyChart').getContext('2d'), configs.consistency);
          resourceUtilizationChart = new Chart(document.getElementById('resourceUtilizationChart').getContext('2d'), configs.resourceUtilization);

          // --- Update summary cards ---
          document.getElementById('total-study-time').textContent = data.summary.totalStudyTime;
          document.getElementById('total-study-time-label').textContent = `Hours ${capitalize(period)}`;
          document.getElementById('cases-reviewed').textContent = data.summary.casesReviewed;
          document.getElementById('cases-reviewed-label').textContent = `${capitalize(period)}`;
          document.getElementById('tasks-completed').textContent = data.summary.tasksCompleted;
          document.getElementById('tasks-completed-label').textContent = `Of ${data.summary.tasksAssigned} Assigned`;
          document.getElementById('quiz-average').textContent = data.summary.quizAverage + '%';
          document.getElementById('quiz-average-label').textContent = 'Across All Subjects';

          // --- Update weak areas ---
          const weakList = document.getElementById('weak-areas-list');
          weakList.innerHTML = '';
          data.weakAreas.forEach(area => {
            const badgeClass = area.score < 70 ? 'badge-danger' : 'badge-warning';
            weakList.innerHTML += `<li class="list-group-item d-flex justify-content-between align-items-center">${area.topic}<span class="badge ${badgeClass} badge-pill">${area.score}%</span></li>`;
          });

          // --- Update recommendations ---
          const recList = document.getElementById('recommendations-list');
          recList.innerHTML = '';
          data.recommendations.forEach(rec => {
            recList.innerHTML += `<div class="card mb-2 bg-light"><div class="card-body py-2"><p class="mb-1"><strong>${rec.title}:</strong> ${rec.text}</p>${rec.action ? `<a href="#" class="btn btn-sm btn-outline-primary">${rec.action}</a>` : ''}</div></div>`;
          });

          // --- Update most used resources ---
          const resList = document.getElementById('resource-list');
          resList.innerHTML = '';
          data.resources.forEach(res => {
            resList.innerHTML += `<a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">${res.name}<span class="badge badge-primary badge-pill">${res.hours} hrs</span></a>`;
          });
        } catch (err) {
          // Fallback: show demo data if fetch fails
          console.error('Failed to load insights:', err);
        }
      }
      function capitalize(str) { return str.charAt(0).toUpperCase() + str.slice(1); }

      // --- Period button event listeners ---
      document.querySelectorAll('.btn-group [data-period]').forEach(btn => {
        btn.addEventListener('click', function () {
          document.querySelectorAll('.btn-group [data-period]').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          loadInsights(this.getAttribute('data-period'));
        });
      });

      // --- Initial load ---
      loadInsights();
    </script>
  </body>
</html>